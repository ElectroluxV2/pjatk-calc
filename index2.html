<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Silnik analityczny ‚Äì Dane Micha≈Ça (C++)</title>
    <style>
        :root { color-scheme: light dark; }

        html, body {
            height: 100vh;
            margin: 0;
            background-color: light-dark(#f8f9fa, #121212);
            color: light-dark(#222, #eee);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: light-dark(#1a5276, #5dade2);
            font-size: 1.5em;
            margin: 10px 0 12px;
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 20px;
            box-sizing: border-box;
            gap: 20px;
        }

        .table-wrapper {
            flex: 3;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: light-dark(#fff, #1a1a1a);
            font-size: 0.9em;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid light-dark(#ccc, #333);
            padding: 5px 7px;
            vertical-align: top;
        }

        th {
            background-color: light-dark(#e9ecef, #252525);
        }

        td:first-child {
            width: 34%;
            font-weight: bold;
        }

        label {
            display: block;
            margin: 2px 0;
            line-height: 1.25em;
        }

        input[type="checkbox"] {
            transform: scale(0.9);
            margin-right: 6px;
        }

        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 14px;
        }

        .penalty-section, .summary {
            border-radius: 6px;
            padding: 10px 12px;
        }

        .penalty-section {
            background-color: light-dark(#fdecea, #2e1511);
            border-left: 5px solid light-dark(#c0392b, #e74c3c);
            font-size: 0.9em;
        }

        .penalty-section h3 {
            margin: 0 0 4px 0;
            color: light-dark(#922b21, #e57373);
            font-size: 0.95em;
            text-align: center;
        }

        .strike-boxes {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .summary {
            background-color: light-dark(#f1f8f5, #14281d);
            border-left: 5px solid light-dark(#2e7d32, #1abc9c);
            text-align: center;
            font-size: 0.95em;
        }

        .total {
            font-weight: bold;
            color: light-dark(#145a32, #58d68d);
            margin-bottom: 8px;
        }

        #timer {
            margin-bottom: 8px;
            font-family: monospace;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        button {
            background-color: light-dark(#1a5276, #16a085);
            color: light-dark(#fff, #000);
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.9em;
        }

        button:hover {
            background-color: light-dark(#154360, #149174);
        }
    </style>
</head>

<body>
<h1>Silnik analityczny ‚Äì Dane Micha≈Ça (C++)</h1>

<main>
    <div class="table-wrapper">
        <table id="pointsTable">
            <tr><th>Kategoria</th><th>Wymagania (≈ÇƒÖczna suma = 30 pkt)</th></tr>

            <tr>
                <td>1. Autoweryfikacja ‚Äì 6 pkt</td>
                <td>
                    <label><input type="checkbox" /> Przygotowanie lokalnych tablic testowych</label>
                    <label><input type="checkbox" /> Test: wyg≈Çadzanie (≈õrednia ruchoma)</label>
                    <label><input type="checkbox" /> Test: efekt Yo‚ÄëYo (poprawne zliczanie)</label>
                    <label><input type="checkbox" /> Test: najd≈Çu≈ºsza passa spadkowa</label>
                    <label><input type="checkbox" /> Test: najtrudniejszy dzie≈Ñ (mapowanie na nazwƒô)</label>
                    <label><input type="checkbox" /> Raport z test√≥w: OK/B≈ÅƒÑD dla ka≈ºdej funkcji</label>
                </td>
            </tr>

            <tr>
                <td>2. Analiza Danych (Tablice 1D) ‚Äì 7 pkt</td>
                <td>
                    <strong>2.1 Wyg≈Çadzanie Danych ‚Äì 2 pkt</strong>
                    <label><input type="checkbox" /> Funkcja ≈õredniej ruchomej: nowa[i] = (stara[i‚àí1]+stara[i]+stara[i+1])/3.0</label>
                    <label><input type="checkbox" data-weight="2" /> Obs≈Çuga krawƒôdzi (i=0, i=ostatni) sensownie (2 pkt)</label>
                    <strong>2.2 Trendy: Yo‚ÄëYo i Streak ‚Äì 5 pkt</strong>
                    <label><input type="checkbox" /> Efekt Yo‚ÄëYo: zliczenie spadek‚Üíwzrost</label>
                    <label><input type="checkbox" /> Najd≈Çu≈ºsza passa spadkowa</label>
                    <label><input type="checkbox" /> Reset licznika serii przy wzro≈õcie</label>
                    <label><input type="checkbox" /> U≈ºycie pƒôtli (for/while)</label>
                    <label><input type="checkbox" /> Analiza na tablicy wyg≈Çadzonej</label>
                </td>
            </tr>

            <tr>
                <td>3. Metoda 2: Najtrudniejszy Dzie≈Ñ ‚Äì 6 pkt</td>
                <td>
                    <label><input type="checkbox" /> Zsumowanie kolumn dziennikKalorii (pionowo)</label>
                    <label><input type="checkbox" /> Wyliczenie ≈õrednich dla dni tygodnia</label>
                    <label><input type="checkbox" /> Wyznaczenie indeksu maksimum</label>
                    <label><input type="checkbox" /> Mapowanie na nazwƒô dnia (nazwyDni)</label>
                    <label><input type="checkbox" /> Zwr√≥cenie/wy≈õwietlenie najtrudniejszego dnia</label>
                </td>
            </tr>

            <tr>
                <td>4. In≈ºynieria Danych ‚Äì 11 pkt</td>
                <td>
                    <strong>4.1 Normalizacja Makro ‚Äì 5 pkt</strong>
                    <label><input type="checkbox" /> Obliczenie kcal: B*4 + T*9 + W*4</label>
                    <label><input type="checkbox" /> Sprawdzenie przekroczenia limitu</label>
                    <label><input type="checkbox" data-weight="2" /> Proporcjonalne skalowanie B/T/W (2 pkt)</label>
                    <label><input type="checkbox" /> Trafienie w limit (dok≈Çadno≈õƒá) </label>
                    <label><input type="checkbox" /> Zachowanie proporcji wej≈õciowych</label>
                    <strong>4.2 Generowanie Raportu ‚Äì 6 pkt</strong>
                    <label><input type="checkbox" /> Funkcja wype≈Çnia wyniki[3] (bez wy≈õwietlania)</label>
                    <label><input type="checkbox" /> Wyszukanie deficyt√≥w w danych</label>
                    <label><input type="checkbox" /> Wybranie Top 3 najwiƒôkszych deficyt√≥w</label>
                    <label><input type="checkbox" data-weight="2" /> Test poprawno≈õci (autoweryfikacja) (2 pkt)</label>
                </td>
            </tr>
        </table>
    </div>

    <div class="side-panel">
        <div class="penalty-section">
            <h3>Punkty ujemne</h3>
            <label><input type="checkbox" class="penalty" /> Kod nieczytelny / chaotyczny (‚àí1)</label>

            <div class="strike-boxes">
                <label><input type="checkbox" class="strike" /> Strike 1</label>
                <label><input type="checkbox" class="strike" /> Strike 2</label>
                <label><input type="checkbox" class="strike" /> Strike 3</label>
            </div>
        </div>

        <div class="summary">
            <p class="total" id="totalScore">Suma punkt√≥w: 0 / 30</p>
            <p id="timer">Czas od ostatniego resetu: 00:00</p>
            <div class="buttons">
                <button id="copyHtml">üìã Kopiuj raport (Teams)</button>
                <button id="resetForm">üîÑ Resetuj formularz</button>
            </div>
        </div>
    </div>
</main>

<script>
    const allBoxes = document.querySelectorAll("input[type='checkbox']");
    const scoreEl = document.getElementById("totalScore");
    const resetBtn = document.getElementById("resetForm");
    const strikeBoxes = document.querySelectorAll(".strike");

    function calculateStrikePenalty(count) {
        if (count === 1) return 2;
        if (count === 2) return 10;
        if (count === 3) return 20;
        return 0;
    }

    function updateLiveScore() {
        const positives = document.querySelectorAll("input[type='checkbox']:not(.penalty):not(.strike)");
        const penalties = document.querySelectorAll(".penalty");

        let total = 0;
        positives.forEach(c => {
            if (c.checked) {
                const weight = parseInt(c.dataset.weight || '1', 10);
                total += isNaN(weight) ? 1 : weight;
            }
        });

        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);

        minus += calculateStrikePenalty(strikeCount);
        const final = Math.max(total - minus, 0);
        scoreEl.innerText = `Suma punkt√≥w: ${final} / 30 (‚àí${minus} pkt)`;
        unsavedChanges = true;
    }

    allBoxes.forEach(cb => cb.addEventListener("change", updateLiveScore));

    document.getElementById("copyHtml").addEventListener("click", () => {
        const rows = document.querySelectorAll("#pointsTable tr:not(:first-child)");
        let output = "=== Wynik oceny ‚Äì Silnik analityczny: Dane Micha≈Ça (C++) ===\n\n";

        rows.forEach(row => {
            const category = row.cells[0].innerText.trim();
            output += `**${category}**\n`;
            const checks = row.querySelectorAll("label");
            checks.forEach(lbl => {
                const cb = lbl.querySelector("input[type='checkbox']");
                const mark = cb && cb.checked ? "‚úî" : "‚úñ";
                output += `${mark} ${lbl.textContent.trim().replace(/^[‚úî‚úñ]\s*/, "")}\n`;
            });
            output += "\n";
        });

        const penalties = document.querySelectorAll(".penalty");
        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);
        const strikePenalty = calculateStrikePenalty(strikeCount);
        minus += strikePenalty;

        if (minus > 0) {
            output += "**Punkty ujemne:**\n";
            penalties.forEach(p => {
                if (p.checked) output += `‚àí1 ${p.parentElement.textContent.trim()}\n`;
            });
            if (strikeCount > 0)
                output += `‚àí${strikePenalty} (${strikeCount} √ó strike)\n`;
            output += "\n";
        }
        output += scoreEl.innerText;

        navigator.clipboard
            .writeText(output)
            .then(() => alert("‚úî Raport skopiowany ‚Äì wklej do Teams (Ctrl+V)."))
            .catch(() => alert("‚ùå Nie uda≈Ço siƒô skopiowaƒá."));
    });

    // Licznik czasu (tylko minuty i sekundy, lokalny format)
    const timerEl = document.getElementById("timer");
    let timerStartTime = null;
    let timerInterval = null;

    function updateTimerDisplay() {
        if (!timerStartTime) return;

        const elapsedMs = Date.now() - timerStartTime;
        const elapsedDate = new Date(elapsedMs);
        const mm = String(Math.floor(elapsedMs / 60000)).padStart(2, '0');
        const ss = String(elapsedDate.getUTCSeconds()).padStart(2, '0');
        timerEl.innerText = `Czas od ostatniego resetu: ${mm}:${ss}`;
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerStartTime = Date.now();
        timerInterval = setInterval(updateTimerDisplay, 500);
        updateTimerDisplay();
    }

    // Reset formularza i start licznika (z potwierdzeniem)
    let unsavedChanges = false;
    resetBtn.addEventListener("click", () => {
        if (confirm("Czy na pewno chcesz zresetowaƒá formularz?")) {
            document.querySelectorAll("input[type='checkbox']").forEach(cb => cb.checked = false);
            updateLiveScore();
            startTimer();
            unsavedChanges = false;
        }
    });

    // Ostrze≈ºenie o niezapisanych zmianach
    window.addEventListener('beforeunload', (e) => {
        if (!unsavedChanges) return;
        e.preventDefault();
        e.returnValue = '';
    });

    // Inicjalizacja
    startTimer();
    updateLiveScore();
</script>
</body>
</html>
