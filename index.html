<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kalkulator punktacji â€“ Asystent Zdrowego Stylu Å»ycia (C++)</title>
    <style>
        :root { color-scheme: light dark; }

        html, body {
            height: 100vh;
            margin: 0;
            background-color: light-dark(#f8f9fa, #121212);
            color: light-dark(#222, #eee);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            color: light-dark(#1a5276, #5dade2);
            font-size: 1.5em;
            margin: 10px 0 12px;
        }

        main {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 20px;
            box-sizing: border-box;
            gap: 20px;
        }

        .table-wrapper {
            flex: 3;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: light-dark(#fff, #1a1a1a);
            font-size: 0.9em;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th, td {
            border: 1px solid light-dark(#ccc, #333);
            padding: 5px 7px;
            vertical-align: top;
        }

        th {
            background-color: light-dark(#e9ecef, #252525);
        }

        td:first-child {
            width: 34%;
            font-weight: bold;
        }

        label {
            display: block;
            margin: 2px 0;
            line-height: 1.25em;
        }

        input[type="checkbox"] {
            transform: scale(0.9);
            margin-right: 6px;
        }

        .side-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 14px;
        }

        .penalty-section, .summary {
            border-radius: 6px;
            padding: 10px 12px;
        }

        .penalty-section {
            background-color: light-dark(#fdecea, #2e1511);
            border-left: 5px solid light-dark(#c0392b, #e74c3c);
            font-size: 0.9em;
        }

        .penalty-section h3 {
            margin: 0 0 4px 0;
            color: light-dark(#922b21, #e57373);
            font-size: 0.95em;
            text-align: center;
        }

        .strike-boxes {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .summary {
            background-color: light-dark(#f1f8f5, #14281d);
            border-left: 5px solid light-dark(#2e7d32, #1abc9c);
            text-align: center;
            font-size: 0.95em;
        }

        .total {
            font-weight: bold;
            color: light-dark(#145a32, #58d68d);
            margin-bottom: 8px;
        }

        #timer {
            margin-bottom: 8px;
            font-family: monospace;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        button {
            background-color: light-dark(#1a5276, #16a085);
            color: light-dark(#fff, #000);
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.9em;
        }

        button:hover {
            background-color: light-dark(#154360, #149174);
        }
    </style>
</head>

<body>
<h1>Kalkulator punktacji â€“ C++ Asystent Zdrowego Stylu Å»ycia</h1>

<main>
    <div class="table-wrapper">
        <table id="pointsTable">
            <tr><th>Kategoria</th><th>Wymagania (kaÅ¼dy = 1 pkt)</th></tr>

            <tr>
                <td>1. Walidacja danych i menu â€“ 6 pkt</td>
                <td>
                    <label><input type="checkbox" /> Walidacja danych (waga, wzrost, wiek, pÅ‚eÄ‡)</label>
                    <label><input type="checkbox" /> UÅ¼ycie pÄ™tli doâ€‘while</label>
                    <label><input type="checkbox" /> Menu celu (switch)</label>
                    <label><input type="checkbox" /> Menu aktywnoÅ›ci (switch)</label>
                    <label><input type="checkbox" /> Zakresy wartoÅ›ci poprawne</label>
                    <label><input type="checkbox" /> WyÅ›wietlanie opcji menu</label>
                </td>
            </tr>

            <tr>
                <td>2. Obliczenia podstawowe â€“ 5 pkt</td>
                <td>
                    <label><input type="checkbox" /> BMI + interpretacja</label>
                    <label><input type="checkbox" /> BMR (Podstawowa Przemiana Materii)</label>
                    <label><input type="checkbox" /> TDEE (CaÅ‚kowite Dzienne Zapotrzebowanie Energetyczne)</label>
                    <label><input type="checkbox" /> Cel kaloryczny Â±500 / +300</label>
                    <label><input type="checkbox" /> Idealna waga BMI = 22 (pow())</label>
                </td>
            </tr>

            <tr>
                <td>3. Symulacja postÄ™pÃ³w â€“ 10 pkt</td>
                <td>
                    <label><input type="checkbox" /> PÄ™tla while (!cel && tydzieÅ„&lt;52)</label>
                    <label><input type="checkbox" /> Break â€“ osiÄ…gniÄ™cie celu Â±2 kg</label>
                    <label><input type="checkbox" /> Break â€“ BMI poza zakresem 16â€‘35</label>
                    <label><input type="checkbox" /> Zmiana wagi (deficyt / 7700)</label>
                    <label><input type="checkbox" /> Fluktuacje (sin())</label>
                    <label><input type="checkbox" /> Aktualizacja wagi</label>
                    <label><input type="checkbox" /> Motywacja (exp()), efektywnoÅ›Ä‡</label>
                    <label><input type="checkbox" /> Urlop co 8 tyg. (continue)</label>
                    <label><input type="checkbox" /> Podsumowanie i Å›rednia zmiana co 4 tyg. (for)</label>
                    <label><input type="checkbox" /> WyÅ›wietlanie tygodniowych wynikÃ³w</label>
                </td>
            </tr>

            <tr>
                <td>4. Analiza koÅ„cowa â€“ 4 pkt</td>
                <td>
                    <label><input type="checkbox" /> CaÅ‚kowita zmiana wagi i Å›rednia tyg.</label>
                    <label><input type="checkbox" /> BMI koÅ„cowe i interpretacja</label>
                    <label><input type="checkbox" /> Szacowanie czasu do idealnej wagi</label>
                    <label><input type="checkbox" /> Spalone kalorie Å‚Ä…cznie</label>
                </td>
            </tr>
        </table>
    </div>

    <div class="side-panel">
        <div class="penalty-section">
            <h3>Punkty ujemne</h3>
            <label><input type="checkbox" class="penalty" /> Kod nieczytelny / chaotyczny (âˆ’1)</label>

            <div class="strike-boxes">
                <label><input type="checkbox" class="strike" /> Strike 1</label>
                <label><input type="checkbox" class="strike" /> Strike 2</label>
                <label><input type="checkbox" class="strike" /> Strike 3</label>
            </div>
        </div>

        <div class="summary">
            <p class="total" id="totalScore">Suma punktÃ³w: 0 / 25</p>
            <p id="timer">Czas od ostatniego resetu: 00:00</p>
            <div class="buttons">
                <button id="copyHtml">ðŸ“‹ Kopiuj raport (Teams)</button>
                <button id="resetForm">ðŸ”„ Resetuj formularz</button>
            </div>
        </div>
    </div>
</main>

<script>
    const allBoxes = document.querySelectorAll("input[type='checkbox']");
    const scoreEl = document.getElementById("totalScore");
    const resetBtn = document.getElementById("resetForm");
    const strikeBoxes = document.querySelectorAll(".strike");

    function calculateStrikePenalty(count) {
        if (count === 1) return 2;
        if (count === 2) return 10;
        if (count === 3) return 20;
        return 0;
    }

    function updateLiveScore() {
        const positives = document.querySelectorAll("input[type='checkbox']:not(.penalty):not(.strike)");
        const penalties = document.querySelectorAll(".penalty");

        let total = 0;
        positives.forEach(c => total += c.checked ? 1 : 0);

        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);

        minus += calculateStrikePenalty(strikeCount);
        const final = Math.max(total - minus, 0);
        scoreEl.innerText = `Suma punktÃ³w: ${final} / 25 (âˆ’${minus} pkt)`;
        unsavedChanges = true;
    }

    allBoxes.forEach(cb => cb.addEventListener("change", updateLiveScore));

    document.getElementById("copyHtml").addEventListener("click", () => {
        const rows = document.querySelectorAll("#pointsTable tr:not(:first-child)");
        let output = "=== Wynik oceny â€“ Asystent Zdrowego Stylu Å»ycia (C++) ===\n\n";

        rows.forEach(row => {
            const category = row.cells[0].innerText.trim();
            output += `**${category}**\n`;
            const checks = row.querySelectorAll("label");
            checks.forEach(lbl => {
                const cb = lbl.querySelector("input[type='checkbox']");
                const mark = cb && cb.checked ? "âœ”" : "âœ–";
                output += `${mark} ${lbl.textContent.trim().replace(/^[âœ”âœ–]\s*/, "")}\n`;
            });
            output += "\n";
        });

        const penalties = document.querySelectorAll(".penalty");
        let minus = 0;
        penalties.forEach(p => minus += p.checked ? 1 : 0);

        let strikeCount = 0;
        strikeBoxes.forEach(s => strikeCount += s.checked ? 1 : 0);
        const strikePenalty = calculateStrikePenalty(strikeCount);
        minus += strikePenalty;

        if (minus > 0) {
            output += "**Punkty ujemne:**\n";
            penalties.forEach(p => {
                if (p.checked) output += `âˆ’1 ${p.parentElement.textContent.trim()}\n`;
            });
            if (strikeCount > 0)
                output += `âˆ’${strikePenalty} (${strikeCount} Ã— strike)\n`;
            output += "\n";
        }
        output += scoreEl.innerText;

        navigator.clipboard
            .writeText(output)
            .then(() => alert("âœ” Raport skopiowany â€“ wklej do Teams (Ctrl+V)."))
            .catch(() => alert("âŒ Nie udaÅ‚o siÄ™ skopiowaÄ‡."));
    });

    // Licznik czasu (tylko minuty i sekundy, lokalny format)
    const timerEl = document.getElementById("timer");
    let timerStartTime = null;
    let timerInterval = null;

    function updateTimerDisplay() {
        if (!timerStartTime) return;

        const elapsedMs = Date.now() - timerStartTime;
        const elapsedDate = new Date(elapsedMs);
        const formatted = elapsedDate.toLocaleTimeString(undefined, {
            timeZone: "UTC",
            minute: "2-digit",
            second: "2-digit",
        });
        timerEl.textContent = `Czas od ostatniego resetu: ${formatted}`;
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerStartTime = Date.now();
        updateTimerDisplay();
        timerInterval = setInterval(updateTimerDisplay, 1000);
    }

    // Reset formularza + restart zegara
    resetBtn.addEventListener("click", () => {
        if (confirm("Czy na pewno chcesz zresetowaÄ‡ formularz?")) {
            allBoxes.forEach(cb => (cb.checked = false));
            updateLiveScore();
            unsavedChanges = false;
            startTimer(); // reset zegara
        }
    });

    // OstrzeÅ¼enie przy zamkniÄ™ciu
    let unsavedChanges = false;
    window.addEventListener("beforeunload", e => {
        if (unsavedChanges) {
            e.preventDefault();
            e.returnValue = "";
        }
    });

    // Start wszystkiego
    startTimer();
    updateLiveScore();
</script>
</body>
</html>